<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Rally Sync Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #050910;
            color: #f5f5f5;
        }

        .container {
            max-width: 900px;
            margin: 24px auto 40px;
            padding: 16px;
        }

        h1 {
            text-align: center;
            margin-bottom: 22px;   /* ì œëª© ì•„ë˜ ì—¬ë°± */
            font-size: 1.8rem;
            letter-spacing: 0.15em;
        }

        .card {
            background: #111827;
            border-radius: 12px;
            padding: 16px 20px 20px;
            margin-bottom: 18px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            border: 1px solid #1f2937;
        }

        .card h2 {
            margin: 0;
            font-size: 1.2rem;
        }

        .section-title {
            display: flex;
            align-items: baseline; /* ìˆ«ìì™€ ì œëª© ë¼ì¸ ë§ì¶¤ */
            gap: 8px;
            margin-bottom: 10px;
        }

        .section-title .index {
            font-size: 1.2rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .mode-badges {
            display: inline-flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            border: 1px solid #374151;
            background: #020617;
            color: #9ca3af;
        }

        .badge.active {
            background: #2563eb;
            border-color: #3b82f6;
            color: #e5f0ff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 6px;
        }

        thead {
            background: #020617;
        }

        th, td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #1f2937;
            font-size: 0.9rem;
        }

        th {
            font-weight: 500;
            color: #9ca3af;
        }

        tbody tr:hover {
            background: rgba(37, 99, 235, 0.08);
        }

        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 6px 8px;
            border-radius: 8px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            font-size: 0.9rem;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.1s ease;
            white-space: nowrap;
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.4) inset;
        }

        .btn-primary {
            background: #2563eb;
            color: #e5f0ff;
            box-shadow: 0 8px 18px rgba(37,99,235,0.35);
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-outline {
            background: transparent;
            color: #e5e7eb;
            border: 1px solid #4b5563;
        }

        .btn-danger {
            background: #b91c1c;
            color: #fee2e2;
            padding: 4px 10px;
            font-size: 0.8rem;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 0.8rem;
        }

        .add-row-wrapper {
            margin-top: 10px;
            display: flex;
            justify-content: flex-start;
        }

        /* ì§‘ê²°(ë¶„) í† ê¸€ ë²„íŠ¼ */
        .rally-toggle {
            display: inline-flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .rally-btn {
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            font-size: 0.75rem;
            cursor: pointer;
            min-width: 38px;
        }

        .rally-btn.active {
            background: #2563eb;
            border-color: #3b82f6;
            color: #e5f0ff;
        }

        .time-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .time-inputs .time-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .time-inputs .time-box label {
            font-size: 0.8rem;
            color: #9ca3af;
            text-align: center;
            width: 100%;
        }

        .time-inputs input {
            width: 80px;
            text-align: center;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-top: 12px;
            margin-bottom: 6px;
        }

        .result-box {
            margin-top: 2px;
            padding: 10px 12px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid #1f2937;
            font-family: "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 1.1rem;
            line-height: 1.55rem;
            white-space: pre-line;
            max-height: 220px;
            overflow-y: auto;
        }

        .footer-note {
            margin-top: 4px;
            margin-right: 6px;
            font-size: 0.95rem;
            line-height: 1.45rem;
            color: #6b7280;
            text-align: right;
        }

        /* í–‰êµ°(ì´ˆ) ì…ë ¥ UI */
        .march-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .march-input {
            max-width: 80px;
            text-align: center;
        }

        .btn-march {
            padding: 2px 8px;
            font-size: 0.75rem;
            border-radius: 999px;
            border: 1px solid #374151;
            background: #020617;
            color: #e5e7eb;
            cursor: pointer;
        }

        .btn-march:hover {
            background: #1f2937;
        }

        .march-hint {
            margin-top: 3px;
            font-size: 0.75rem;
            color: #9ca3af;
            text-align: center;
            min-height: 16px;
        }

        @media (max-width: 640px) {
            .container {
                padding: 12px;
            }

            th, td {
                font-size: 0.8rem;
                padding: 6px 4px;
            }

            .time-inputs input {
                width: 60px;
            }

            h1 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Rally Sync Manager</h1>

    <!-- 1. ì§‘ê²° í¸ì„± ì„¤ì • -->
    <div class="card">
        <div class="section-title">
            <span class="index">1.</span>
            <h2>ì§‘ê²° í¸ì„± ì„¤ì •</h2>
        </div>

        <div class="mode-badges">
            <span class="badge active">ì§‘ê²° ë„ì°© ê¸°ì¤€ (ìë™ ì²« ì§‘ê²°ì¥ ê³„ì‚°)</span>
        </div>

        <table>
            <thead>
            <tr>
                <th style="width: 26%;">ì´ë¦„</th>
                <th style="width: 24%;">ì§‘ê²°(ë¶„)</th>
                <th style="width: 20%;">í–‰êµ°(ì´ˆ)</th>
                <th style="width: 18%;">ì§€ì—°(ì´ˆ)</th>
                <th style="width: 12%;">ì‚­ì œ</th>
            </tr>
            </thead>
            <tbody id="troop-body">
            <!-- í–‰ì´ JavaScriptë¡œ ì¶”ê°€ë¨ -->
            </tbody>
        </table>

        <div class="add-row-wrapper">
            <button id="addRowBtn" class="btn btn-primary btn-sm">ï¼‹ ì§‘ê²° ì¶”ê°€</button>
        </div>
    </div>

    <!-- 2. ë„ì°© ëª©í‘œ ì‹œê° -->
    <div class="card">
        <div class="section-title">
            <span class="index">2.</span>
            <h2>ë„ì°© ëª©í‘œ ì‹œê°</h2>
        </div>

        <div style="font-size:0.9rem; color:#9ca3af; margin-bottom:4px;">
            ëª¨ë“  ë¶€ëŒ€ê°€ ë„ì°©í•´ì•¼ í•˜ëŠ” ì‹œê°ì„ <b>24ì‹œê°„ í˜•ì‹</b>(HH:MM:SS)ìœ¼ë¡œ ì…ë ¥í•©ë‹ˆë‹¤.<br>
            ì˜ˆ: ìì • 00:00:00, ì˜¤í›„ 2ì‹œëŠ” 14:00:00
        </div>

        <div class="time-inputs">
            <div class="time-box">
                <label for="baseHour">ì‹œ (Hour)</label>
                <input type="number" id="baseHour" min="0" max="23" value="">
            </div>
            <div class="time-box">
                <label for="baseMinute">ë¶„ (Minute)</label>
                <input type="number" id="baseMinute" min="0" max="59" value="">
            </div>
            <div class="time-box">
                <label for="baseSecond">ì´ˆ (Second)</label>
                <input type="number" id="baseSecond" min="0" max="59" value="">
            </div>
        </div>

        <div class="result-header">
            <div style="font-weight:500;">ê²°ê³¼</div>
            <div>
                <button id="copyBtn" class="btn btn-outline btn-sm">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
            </div>
        </div>

        <div class="result-box" id="resultBox">
            ì§‘ê²°ì„ ì¶”ê°€í•˜ê³  ë„ì°© ëª©í‘œ ì‹œê°ì„ ì…ë ¥í•˜ë©´ ì—¬ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.
        </div>

        <div class="footer-note">
            ì‹œì‘ = ëª©í‘œë„ì°© âˆ’ ì§‘ê²°(ë¶„) âˆ’ í–‰êµ°(ì´ˆ) + ì§€ì—°(ì´ˆ) / ë„ì°© = ëª©í‘œë„ì°© + ì§€ì—°(ì´ˆ)<br>
            ì²« ì§‘ê²° ìƒì„± ì‹œê° = ê°€ì¥ ë¹ ë¥¸ ì§‘ê²° ì‹œì‘ ì‹œê°
        </div>

        <div style="
            text-align:center;
            position:relative;
            top:70px;
            margin-bottom:2px;
            color:#cbd5e1;
            font-size:0.9rem;
            font-weight:500;
            line-height:1.2rem;
        ">
            Â© 2025 Created by ë°©ìš¸ Â· #1
        </div>

    </div>
</div>

<script>
    let lastCopyText = "";

    function pad2(num) {
        return num.toString().padStart(2, "0");
    }

    // mm:ss ë˜ëŠ” ss í˜•íƒœë¥¼ ì´ˆ(second)ë¡œ ë³€í™˜
    function parseTimeInput(val) {
        if (!val) return 0;
        val = String(val).trim();

        if (val.includes(":")) {
            const parts = val.split(":");
            let m = parseInt(parts[0].replace(/\D/g, ""), 10);
            let s = parseInt((parts[1] || "0").replace(/\D/g, ""), 10);

            if (isNaN(m)) m = 0;
            if (isNaN(s)) s = 0;

            // 1:75 â†’ 2:15 ë¡œ ë³´ì •
            if (s >= 60) {
                m += Math.floor(s / 60);
                s = s % 60;
            }

            return m * 60 + s;
        }

        const n = parseInt(val.replace(/\D/g, ""), 10);
        return isNaN(n) ? 0 : n;
    }

    // ì´ˆ â†’ "M:SS" í˜•ì‹
    function formatMMSS(sec) {
        sec = Math.max(0, parseInt(sec, 10) || 0);
        const m = Math.floor(sec / 60);
        const s = sec % 60;
        if (m === 0) {
            return String(s);
        }
        return m + ":" + pad2(s);
    }

    function formatTimeFromSeconds(totalSeconds) {
        const secondsInDay = 24 * 3600;
        let sec = ((totalSeconds % secondsInDay) + secondsInDay) % secondsInDay;

        const h = Math.floor(sec / 3600);
        sec %= 3600;
        const m = Math.floor(sec / 60);
        const s = sec % 60;

        return pad2(h) + ":" + pad2(m) + ":" + pad2(s);
    }

    function getBaseSeconds() {
        const hRaw = document.getElementById("baseHour").value;
        const mRaw = document.getElementById("baseMinute").value;
        const sRaw = document.getElementById("baseSecond").value;

        if (hRaw === "" && mRaw === "" && sRaw === "") {
            return null;
        }

        const h = parseInt(hRaw, 10) || 0;
        const m = parseInt(mRaw, 10) || 0;
        const s = parseInt(sRaw, 10) || 0;

        const hh = Math.min(Math.max(h, 0), 23);
        const mm = Math.min(Math.max(m, 0), 59);
        const ss = Math.min(Math.max(s, 0), 59);

        return hh * 3600 + mm * 60 + ss;
    }

    function recalc() {
        const tbody = document.getElementById("troop-body");
        const rows = tbody.querySelectorAll("tr");
        const box = document.getElementById("resultBox");

        if (rows.length === 0) {
            box.textContent = "ì§‘ê²°ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.";
            lastCopyText = "";
            return;
        }

        const baseSeconds = getBaseSeconds();
        if (baseSeconds === null) {
            box.textContent = "ë„ì°© ëª©í‘œ ì‹œê°ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.";
            lastCopyText = "";
            return;
        }

        const items = [];

        rows.forEach(function (row, index) {
            const nameInput = row.querySelector(".name");
            const marchInput = row.querySelector(".march");
            const delayInput = row.querySelector(".delay");
            const rallyToggle = row.querySelector(".rally-toggle");
            const marchHint = row.querySelector(".march-hint");

            // ì™„ì „íˆ ë¹ˆ í–‰ì€ ê³„ì‚°ì—ì„œ ì œì™¸
            const isNameEmpty = !nameInput.value.trim();
            const isMarchEmpty = !marchInput.value.trim();
            const isDelayEmpty = !delayInput.value.trim();
            if (isNameEmpty && isMarchEmpty && isDelayEmpty) {
                if (marchHint) marchHint.textContent = "";
                return;
            }

            const name = (nameInput.value || "").trim() || (index + 1) + "ë²ˆ";

            let rallyMin = 0;
            if (rallyToggle) {
                const activeBtn = rallyToggle.querySelector(".rally-btn.active");
                if (activeBtn) {
                    rallyMin = parseInt(activeBtn.dataset.value, 10) || 0;
                }
            }

            const marchSec = parseTimeInput(marchInput.value);
            const delaySec = parseInt(delayInput.value, 10) || 0;

            // í–‰êµ° ì‹œê°„ í‘œì‹œ
            if (marchHint) {
                if (marchSec > 0) {
                    marchHint.textContent = "í–‰êµ°: " + formatMMSS(marchSec) + " (" + marchSec + "ì´ˆ)";
                } else {
                    marchHint.textContent = "";
                }
            }

            const startSeconds = baseSeconds - rallyMin * 60 - marchSec + delaySec;
            const arrivalSeconds = baseSeconds + delaySec;

            items.push({
                idx: index + 1,
                name,
                rallyMin,
                marchSec,
                delaySec,
                startSeconds,
                arrivalSeconds
            });
        });

                // ëª¨ë“  í–‰ì´ ë¹„ì–´ ìˆìœ¼ë©´
        if (items.length === 0) {
            box.textContent = "ì§‘ê²° ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
            lastCopyText = "";
            return;
        }

        // ì²« ì§‘ê²°ì¥ ì„ íƒ (ê°€ì¥ ë¹ ë¥¸ ì§‘ê²° ì‹œì‘ ì‹œê°)
        let leader = items[0];
        items.forEach(function (it) {
            if (it.startSeconds < leader.startSeconds) {
                leader = it;
            }
        });

        const leaderStartText = formatTimeFromSeconds(leader.startSeconds);
        const headerLine =
            "ì²« ì§‘ê²° ìƒì„± ì‹œê°: " + leaderStartText +
            " (ì²« ì§‘ê²°ì¥: " + leader.name + ")";

        // ğŸ”½ ì—¬ê¸°ì„œë¶€í„° ì¶”ê°€: ë„ì°© ì‹œê°„ ê¸°ì¤€ ì •ë ¬
        const sortedItems = items.slice().sort(function (a, b) {
            if (a.arrivalSeconds !== b.arrivalSeconds) {
                // ì˜ˆìƒ ë„ì°© ì‹œê°„ì´ ë¹ ë¥¸ ìˆœìœ¼ë¡œ
                return a.arrivalSeconds - b.arrivalSeconds;
            }
            // ë„ì°© ì‹œê°„ì´ ê°™ìœ¼ë©´ ì§‘ê²° ì‹œì‘ì´ ë¹ ë¥¸ ìˆœìœ¼ë¡œ
            return a.startSeconds - b.startSeconds;
        });

        const lines = sortedItems.map(function (it) {
            const startText = formatTimeFromSeconds(it.startSeconds);
            const arrivalText = formatTimeFromSeconds(it.arrivalSeconds);

            return (
                it.name + ": ì§‘ê²° ì‹œì‘ " + startText +
                " | " + it.rallyMin + "ë¶„ ì§‘ê²°" +
                " | ì˜ˆìƒ ë„ì°© " + arrivalText
            );
        });

        const fullText = headerLine + "\n" + lines.join("\n");
        box.textContent = fullText;
        lastCopyText = fullText;
    }


    function attachRowEvents(row) {
        const nameInput = row.querySelector(".name");
        const marchInput = row.querySelector(".march");
        const delayInput = row.querySelector(".delay");
        const rallyButtons = row.querySelectorAll(".rally-btn");
        const adjustButtons = row.querySelectorAll(".btn-march");
        const marchHint = row.querySelector(".march-hint");

        [nameInput, delayInput].forEach(function (input) {
            if (!input) return;
            input.addEventListener("input", recalc);
        });

        if (marchInput) {
            marchInput.addEventListener("input", function () {
                recalc();
            });

            marchInput.addEventListener("blur", function () {
                const sec = parseTimeInput(marchInput.value);
                if (sec <= 0) {
                    marchInput.value = "";
                    if (marchHint) marchHint.textContent = "";
                } else {
                    marchInput.value = formatMMSS(sec);
                }
                recalc();
            });
        }

        rallyButtons.forEach(function (btn) {
            btn.addEventListener("click", function () {
                rallyButtons.forEach(function (b) {
                    b.classList.remove("active");
                });
                btn.classList.add("active");
                recalc();
            });
        });

        adjustButtons.forEach(function (btn) {
            btn.addEventListener("click", function () {
                const delta = parseInt(btn.dataset.delta, 10) || 0;
                let sec = parseTimeInput(marchInput.value);
                sec = Math.max(0, sec + delta);
                if (sec === 0) {
                    marchInput.value = "";
                    if (marchHint) marchHint.textContent = "";
                } else {
                    marchInput.value = formatMMSS(sec);
                }
                recalc();
            });
        });

        const delBtn = row.querySelector(".btn-delete");
        if (delBtn) {
            delBtn.addEventListener("click", function () {
                row.remove();
                recalc();
            });
        }
    }

    function createRow(defaults, deletable = true) {
        const tbody = document.getElementById("troop-body");
        const tr = document.createElement("tr");

        const d = Object.assign({
            name: "",
            rally: 5,
            march: "",
            delay: ""
        }, defaults || {});

        const rallyVal = parseInt(d.rally, 10) || 5;

        const deleteCellHtml = deletable
            ? `<button type="button" class="btn btn-danger btn-delete">Del</button>`
            : "";

        tr.innerHTML = `
            <td>
                <input type="text" class="name" placeholder="ë‹‰ë„¤ì„" value="${d.name}">
            </td>
            <td>
                <div class="rally-toggle" style="display:flex; flex-direction:column; gap:4px;">
                    <div style="display:flex; gap:4px; justify-content:center;">
                        <button type="button" class="rally-btn ${rallyVal === 1 ? "active" : ""}"  data-value="1">1ë¶„</button>
                        <button type="button" class="rally-btn ${rallyVal === 3 ? "active" : ""}"  data-value="3">3ë¶„</button>
                        <button type="button" class="rally-btn ${rallyVal === 5 ? "active" : ""}"  data-value="5">5ë¶„</button>
                    </div>
                    <div style="display:flex; gap:4px; justify-content:center;">
                        <button type="button" class="rally-btn ${rallyVal === 15 ? "active" : ""}" data-value="15">15ë¶„</button>
                        <button type="button" class="rally-btn ${rallyVal === 30 ? "active" : ""}" data-value="30">30ë¶„</button>
                        <button type="button" class="rally-btn ${rallyVal === 60 ? "active" : ""}" data-value="60">60ë¶„</button>
                    </div>
                </div>
            </td>
            <td>
                <div class="march-wrapper">
                    <button type="button" class="btn-march" data-delta="-1">-1</button>
                    <input type="text" class="march march-input" value="${d.march}" placeholder="ì˜ˆ: 1:30">
                    <button type="button" class="btn-march" data-delta="1">+1</button>
                </div>
                <div class="march-hint"></div>
            </td>
            <td>
                <input type="number" class="delay" min="0" step="1" value="${d.delay}">
            </td>
            <td>
                ${deleteCellHtml}
            </td>
        `;

        tbody.appendChild(tr);
        attachRowEvents(tr);
    }

    document.addEventListener("DOMContentLoaded", function () {
        // ì²˜ìŒ ë³´ì´ëŠ” ê³ ì • 3ì¤„: ì‚­ì œ ë²„íŠ¼ ì—†ìŒ
        createRow({}, false);
        createRow({}, false);
        createRow({}, false);

        document.getElementById("addRowBtn").addEventListener("click", function () {
            createRow({}, true); // ì¶”ê°€ í–‰ë§Œ ì‚­ì œ ê°€ëŠ¥
            recalc();
        });

        document.getElementById("baseHour").addEventListener("input", recalc);
        document.getElementById("baseMinute").addEventListener("input", recalc);
        document.getElementById("baseSecond").addEventListener("input", recalc);

        document.getElementById("copyBtn").addEventListener("click", function () {
            if (!lastCopyText) return;
            if (!navigator.clipboard) {
                alert("í´ë¦½ë³´ë“œ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤.");
                return;
            }
            navigator.clipboard.writeText(lastCopyText);
        });
    });
</script>
</body>
</html>
